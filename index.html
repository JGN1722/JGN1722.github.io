<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Markdown Viewer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        #readme {
            margin-top: 20px;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
            background-color: #f9f9f9;
            overflow-wrap: break-word; /* Prevent text overflow */
        }
        #readme img {
            max-width: calc(100% - 20px); /* Ensure images fit the container */
            height: auto; /* Maintain aspect ratio */
            display: block;
            margin: 10px 0; /* Center the image */
        }
        #readme pre {
            white-space: pre-wrap; /* Allow line breaking in code blocks */
            overflow-x: auto; /* Add horizontal scroll if necessary */
            background-color: #f3f3f3; /* Light gray background for code */
            padding: 10px;
            border-radius: 5px;
        }
        button {
            padding: 10px 15px;
            font-size: 16px;
            cursor: pointer;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        #view-button {
            display: none;
            text-decoration: none;
            padding: 10px 15px;
            font-size: 16px;
            background-color: #28a745;
            color: white;
            border-radius: 5px;
        }
        #view-button:hover {
            background-color: #218838;
        }
    </style>
</head>
<body>
    <h1>Dynamic Markdown Viewer</h1>
    <button id="home-button" disabled>Home</button>
    <a id="view-button" href="#" target="_blank">View Repository on GitHub</a>
    <div id="readme"></div>

    <script src="https://cdn.jsdelivr.net/npm/showdown@2.1.0/dist/showdown.min.js"></script>
    <script>
        // Constants
        const username = 'JGN1722';
        const filename = 'README.md';
        const branch = 'main';

        // Default content as a string
        const defaultContent = `
            <p>Hi ! I'm JGN, a french developer. I'm currently preparing the engineering exams at prepa Paul Val√©ry, in Paris. Below is a collection of my best projects, going from 3D experiments on my calculator (that I used as the subject of my high school final exam) to a full blown operating system, still a work in progress at the present time.</p>
            <h3>Calculator Games</h3>
            <p>These projects are a bunch of games and programs for the <a src="http://numworks.com">Numworks</a> graphical calculator. The majority are pretty basic but others are more advanced.</p>
            <button class="fetch-button" data-path="CalculatorGames">See the readme</button>
            <h3>DBasic</h3>
            <p>DBasic is a bit of a  BASIC-like programming language, as the name cleverly suggests. I built it to look somewhat like <a src="https://en.m.wikipedia.org/wiki/VBScript">VBScript</a>, the first language I learned. It was a sentimental project, as its purpose was learning enough about compilers to be able to rebuild VBScript when Microsoft decides to kill it. It was also very educational and I learned a whole lot about programming.</p>
            <button class="fetch-button" data-path="DBasic">See the readme</button>
            <h3>PythonCraft</h3>
            <p>This project is a simplistic <a src="https://en.m.wikipedia.org/wiki/Minecraft">Minecraft</a> clone. It does not feature any gameplay mechanic, though hopefully one day it will. The main goal of it was learning about opengl and random world generation, which are both very interesting topics.</p>
            <button class="fetch-button" data-path="PythonCraft">See the readme</button>
            <h3>RoverOS</h3>
            <p>I've been wanting to build my own os pretty much from the moment I started learning programming. It's still a work in progress, as it's a very ambitious project: I want to have written every byte of the code, and I am thus creating a compiler just for it, and that's why this project is so time consuming. It may take a few more months or even years, as I'm building it completely from scratch, but the goal is to make it a completely functional operating system one can use in their everyday life.</p>
            <button class="fetch-button" data-path="RoverOs">See the readme</button>
        `;

        // Track the currently displayed repository
        let currentRepo = null;

        // Function to display default content
        function showDefaultContent() {
            document.getElementById('readme').innerHTML = defaultContent;
            document.getElementById('view-button').style.display = 'none'; // Hide the view button
            document.getElementById('home-button').disabled = true; // Disable Home button
            currentRepo = null; // Clear the current repository
            addFetchButtonListeners(); // Add listeners for the fetch buttons
        }

        // Function to fetch and display a Markdown file
        async function fetchAndDisplayMarkdown(repo) {
            const readmeUrl = `https://raw.githubusercontent.com/${username}/${repo}/${branch}/${filename}`;
            const baseRawUrl = `https://raw.githubusercontent.com/${username}/${repo}/${branch}/`;
            const container = document.getElementById('readme');

            try {
                // Fetch the raw Markdown file
                const response = await fetch(readmeUrl);
                if (!response.ok) {
                    throw new Error('Failed to fetch file.');
                }
                let markdown = await response.text();

                // Replace relative image paths with full GitHub raw URLs
                markdown = markdown.replace(/!\[(.*?)\]\((?!http)(.*?)\)/g, (match, altText, relativePath) => {
                    const fullPath = baseRawUrl + relativePath;
                    return `![${altText}](${fullPath})`;
                });

                // Convert Markdown to HTML using Showdown
                const converter = new showdown.Converter();
                const html = converter.makeHtml(markdown);

                // Display the converted HTML in the container
                container.innerHTML = html;

                // Update the current repository and show the view button
                currentRepo = repo;
                const githubRepoUrl = `https://github.com/${username}/${repo}`;
                const viewButton = document.getElementById('view-button');
                viewButton.href = githubRepoUrl; // Link to the repository's base URL
                viewButton.style.display = 'inline-block'; // Show the view button

                // Enable the Home button
                document.getElementById('home-button').disabled = false;
            } catch (error) {
                console.error(error);
                container.textContent = 'Error loading file. Please check the console for more details.';
            }
        }

        // Function to add event listeners to fetch buttons
        function addFetchButtonListeners() {
            document.querySelectorAll('.fetch-button').forEach(button => {
                const filePath = button.getAttribute('data-path');
                button.addEventListener('click', () => fetchAndDisplayMarkdown(filePath));
            });
        }

        // Add listener for the Home button
        document.getElementById('home-button').addEventListener('click', showDefaultContent);

        // Show the default content on page load
        showDefaultContent();
    </script>
</body>
</html>
